# 基础功能

## 多版本并发控制

### 实验描述

多版本并发控制用于解决并发查询处理中的读写和写读冲突，需要在 Table 相关类中添加版本信息以及并在查询记录时判断记录对事务的可见性。

### 实现思路

-   步骤 1：修改 Table 类插入、删除以及更新记录的函数，添加版本信息。

在实验 1 和 2 中完成的 Table 和 TablePage 的处理中没有考虑到事务的版本信息，需要在本次实验中将其补充。

-   步骤 2：补全 SeqScanExecutor::Next 函数中活跃事务表的获取，用于传递当前活跃事务信息。

多版本并发控制的数据表扫描中需要获取查询执行时的活跃事务表，结合隔离级别生成正确的活跃事务表即可。

-   步骤 3：补全 TableScan 的 IsVisible 函数，用于在查询记录时判断记录版本对于事务的可见性。

根据隔离级别、记录的版本号以及当前事务的状态信息确定某条记录是否对于该事务可见。这部分是 MVCC 技术的关键的内容，建议充分理解课程内容后实现。

完成上面三个步骤即可补全多版本并发控制的功能。

## 两阶段锁协议

### 实验描述

悲观并发控制用于解决并发查询处理中写写冲突，需要实现两阶段锁协议来避免不同事务对于相同记录的冲突修改，实验中需要补全锁管理器相关类。

### 实现思路

-   步骤 1：补全 LockManager 的相关函数，完成表级锁和行级锁的控制和管理。

<!--TODO:此处可以添加锁的级别-->

LockManager 定义了表级锁和行级锁的相关接口，同时按照不同等级区分了多种类型的锁结构。实验要求补全表级别和行级别的加锁和解锁函数，以及相关的辅助函数。
需要特别注意，实验框架中仅实现了事务锁，没有实现页面锁。

-   步骤 2：补全算子中申请锁的部分。

补全 Insert、Delete 和 Unpdate 三个算子执行过程中的写锁申请部分，用于解决基本的写写冲突。
补全 LockRows 算子执行过程中的读锁或写锁的申请，用于支持 SELECT ... FOR SHARE 和 SELECT ... FOR UPDATE 类查询语句。

完成上面两个步骤即可补全基于两阶段锁的悲观并发控制的功能。

## 基础功能实现顺序及测例分析

### 修改插入删除操作，在记录头存储 xid cid，通过 lab 1 和 lab 2 所有测例

### 解决 Halloween Problem

### 增加读已提交隔离级别下的可见性判断

### 实现可重复读，通过 MVCC 测例

### 完成锁管理器，增加加锁逻辑

### 实现读未提交

### 实现 MV2PL 逻辑，判断锁的相容性
