# 高级功能

## 任务 1：死锁预防与死锁检测（2 分）

### 实验描述

悲观并发控制机制在框架中加入两阶段锁机制来解决写写冲突问题，但是缺少对于死锁情况的处理，高级功能中需要在框架基础上添加死锁检测机制解决死锁问题。

### 实现思路

-   步骤 0：阅读教材相关内容，理解死锁发生的条件并设计产生死锁的测例文件。

-   步骤 1：涉及死锁检测机制，可以考虑使用锁申请的等待时间作为检测标准。

-   步骤 2：当检测到死锁后撤销当前事务并重做，注意重做的启动时间问题，避免相同事务重复陷入死锁状态。

## 任务 2：基于版本链的垃圾回收（2 分）

### 实验描述

与实验 1 的高级功能类似，本任务需要对无用元组进行回收。然而与实验 1 通过全表扫描进行垃圾回收的方法不同，本任务需要基于 MVCC 版本链实现记录扫描过程中的垃圾回收操作。

### 实现思路

-   步骤 1：为记录头添加版本链信息，从旧版本指向新版本。

-   步骤 2：修改记录扫描的逻辑，在扫描过程中回收无用的旧版本数据。
