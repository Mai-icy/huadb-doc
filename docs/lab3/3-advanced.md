# 高级功能

## 任务 1：死锁预防与死锁检测（2 分）

### 实验描述

悲观并发控制机制在框架中加入两阶段锁机制来解决写写冲突问题，但是缺少对于死锁情况的处理，高级功能中需要在框架基础上添加死锁检测机制解决死锁问题。

### 实现思路

-   步骤 0：阅读教材相关内容，理解死锁发生的条件并设计产生死锁的测例文件。

-   步骤 1：涉及死锁检测机制，可以考虑使用锁申请的等待时间作为检测标准。

-   步骤 2：当检测到死锁后撤销当前事务并重做，注意重做的启动时间问题，避免相同事务重复陷入死锁状态。

## 任务 2：乐观并发控制（2 分）

### 实验描述

基础功能中采用悲观并发控制解决写写冲突，在此基础上添加使用严格时间戳协议的乐观并发控制功能。

### 实现思路

-   步骤 1：添加判断标志，当标记为乐观模式下跳过悲观并发控制中的相关锁操作。

-   步骤 2：在 Table 类中添加页面锁，避免页面的写冲突，并添加单个页面的时间戳检测机制。

-   步骤 3：添加新的类，用于整体检测乐观并发控制过程严格时间戳规则是否被满足，冲突时撤销事务。

-   步骤 4：设计合理的事务重启机制，避免相同事务重复撤销导致的“饿死”问题。
