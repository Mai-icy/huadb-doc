# 基础功能

## 事务的回滚

### 实验描述

### 实现思路

## 物理日志的设计

### 实验描述

补全 log/logs 文件夹下 insert_log.h 和 delete_log.h 来完成物理日志的设计，并修改 Table 类中对应函数。

### 实现思路

日志设计的核心在于规划日志的存储格式，以及利用存储信息实现 Redo 和 Undo 的方式。可以按照如下的顺序完成本次实验：

-   步骤 0：结合课程内容，思考为什么仅使用物理日志不会影响系统正确性

-   步骤 1：补全 log/insert_log.h 和 log/delete_log.h，实现插入和删除记录的物理日志

框架已经给出了这两类日志所需的必要信息，并实现了序列化和反序列化函数。实验中要求根据存储的信息确定在重做或撤销过程中，如何利用存储信息还原操作对于页面的影响。

-   步骤 2：修改 table/table.cpp，添加记录变更时日志记录的操作

log_manager 文件中的日志管理器 LogManager 类已经提供了追加写出日志的接口，并在内部完成相关的缓存管理功能。
因此本次实验仅需要在实验 1 的基础上，利用 LogManager 提供的追加日志接口(AppendXXXLog)在记录变更时记录对应的日志即可。

完成上面两个步骤即可补全物理日志的功能。

## ARIES 恢复算法

### 实验描述

补全 log_manager.cpp 中 LogManager 类的 Analyze，Redo，Undo 函数，从而补全 ARIES 故障恢复算法。

### 实现思路

ARIES 故障恢复算法是针对于 steal+no-force 数据库系统的一种故障恢复算法，在实现前需要充分理解课程中讲解的 ARIES 算法执行流程。
可以按照算法的执行顺序依次补全 3 个函数：

-   步骤 1：补全 LogManager::Analyze，ARIES 算法的分析过程

ARIES 算法的分析过程读取检查点信息，恢复故障时的数据库状态并恢复活跃事务表和脏页表。
实验框架中已经给出了数据库状态的恢复过程，本次实验中需要基于 checkpoint_lsn 恢复活跃事务表、脏页表以及算法所需的 LSN 信息。

-   步骤 2：补全 LogManager::Redo，ARIES 算法的重做过程

ARIES 的重做过程要求按照算法流程（需要步骤 1 中恢复的 LSN 信息）遍历执行日志的重做过程来恢复系统故障时缓存内的脏页状态。
该步骤的正确性依赖于物理日志设计中 Redo 函数的正确性。

-   步骤 3：补全 LogManager::Undo，ARIES 算法的撤销过程

ARIES 的撤销过程需要根据活跃事务表撤销未提交事务产生的页面更新，该步骤的正确性依赖于前两个步骤的正确性和物理日志设计中 Undo 函数的正确性。

完成上面三个步骤即可补全 ARIES 恢复算法。

## 基础功能实现顺序及测例分析

### 实现事务回滚

insert delete

### 实现故障恢复重做

insert delete new_page

### 实现 Aries
